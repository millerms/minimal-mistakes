/* Reusable Glass + Reveal UI Snippets */

/* Tokens (Glass + Motion) */
:root {
  /* Glass base */
  --glass-tint: 220 55% 25%;
  --glass-alpha: 0.10;       /* surface opacity */
  --glass-stroke: 0.30;      /* border opacity */
  --glass-shadow: 0.35;      /* shadow opacity */
  --glass-tint-hsl-submenu: 220 31% 25%;


  /* Derived */
  --glass-bg: hsl(var(--glass-tint) / var(--glass-alpha));
  --glass-bg-strong: hsl(var(--glass-tint) / 0.35);
  --glass-border: hsl(var(--glass-tint) / var(--glass-stroke));
  --glass-shadow-light: rgba(0,0,0,var(--glass-shadow));

  /* Radii, blur, timing */
  --r-lg: 20px; --r-md: 14px; --r-sm: 10px;
  --blur-lg: 18px; --blur-md: 12px; --blur-sm: 4px;
  --t-fast: 0.18s; --t-med: 0.28s;
  --e-out: cubic-bezier(0.22, 0.61, 0.36, 1);

  /* Reveal system */
  --reveal-duration: 0.5s;
  --reveal-ease: cubic-bezier(0.215, 0.61, 0.355, 1);
  --reveal-offset: 12px;
  --reveal-blur: 0.25px;
}

@media (prefers-color-scheme: dark) {
  :root { --glass-shadow: 0.45; }
}

/* Fallback for browsers without backdrop-filter */
@supports not (backdrop-filter: blur(1px)) {
  .glass { background-color: var(--glass-bg-strong) !important; }
}

/* CSS: Glass Utilities */
/* Core glass surface */
.glass {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--r-lg);
  box-shadow: 0 8px 30px var(--glass-shadow-light), inset 0 1px 0 rgba(255,255,255,0.06);
  -webkit-backdrop-filter: blur(var(--blur-lg)) saturate(115%);
  backdrop-filter: blur(var(--blur-lg)) saturate(115%);
}

/* Elevated card variant */
.glass.card { padding: clamp(14px, 2vw, 22px); border-radius: var(--r-lg); }

/* Optional: make Minimal Mistakes masthead glassy (single overlay) */
/* Keep outer containers transparent to avoid stacked tints */
.masthead, .site-header, .greedy-nav, .greedy-nav .hidden-links {
  background-color: transparent !important;
  box-shadow: none;
}

/* Inner wrap stays transparent; blur/tint live on .masthead */
.masthead__inner-wrap {
  padding-left: .75rem;
  padding-right: .75rem;
  background: transparent !important;
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  box-shadow: none;
  border: 0;
}

/* Remove underline/box effects from greedy containers */
.masthead .masthead__menu,
.masthead .greedy-nav {
  background: transparent !important;
  box-shadow: none;
  border: 0;
}

/* Bolder masthead and dropdown links for readability */
.masthead .greedy-nav a { font-weight: 700; letter-spacing: .01em; }
.masthead .greedy-nav .hidden-links a { font-weight: 700; }
.masthead .site-title,
.masthead .site-title a { font-weight: 800; }

/* Sticky masthead with glass following on scroll */
.masthead {
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  z-index: 1000; /* above content so blur overlays text */
  -webkit-backdrop-filter: blur(8px) saturate(120%);
  backdrop-filter: blur(8px) saturate(120%);
  background-color: var(--header-glass-bg) !important; /* theme-aware */
  border-bottom: 1px solid var(--glass-border);
  box-shadow: 0 8px 26px rgba(0,0,0,.22);
}

/* Frosted hamburger dropdown (Greedy Nav hidden links) */
/* Hidden links panel as frosted dropdown when visible */
.masthead .greedy-nav { position: relative; }
.masthead .greedy-nav .hidden-links {
  background: hsl(var(--glass-tint-hsl-submenu) / .8) !important;
  box-shadow: none;
  border: 0;
  border-radius: var(--r-md);
}
.masthead .greedy-nav .hidden-links:not(.hidden) {
  position: absolute; top: calc(100% + 8px); right: .75rem; display: flex; flex-direction: column;
  gap: .25rem; padding: .5rem; border-radius: var(--radius-lg);
  -webkit-backdrop-filter: blur(16px) saturate(180%);
  backdrop-filter: blur(16px) saturate(180%);
  background-color: hsl(var(--glass-tint-hsl-submenu) / .8) !important;
  border: 1px solid hsl(var(--glass-tint-hsl-submenu) / .60);
  border-radius: var(--r-md);
  box-shadow: 0 12px 32px rgba(0,0,0,.40);
}

.masthead .greedy-nav .hidden-links a:hover,
.masthead .greedy-nav .hidden-links a:focus {
  background: color-mix(in srgb, var(--glass-tint-hsl-submenu) 35%, transparent);
  text-decoration: none;
  box-shadow: none;
}

@supports not ((-webkit-backdrop-filter: none) or (backdrop-filter: none)) {
  .masthead .greedy-nav .hidden-links {
    background-color: var(--c-surface) !important;
    box-shadow: 0 12px 28px rgba(0,0,0,.25);
  }
}

/* Subtle halo to improve link legibility over scrolled content */
.greedy-nav a,
.site-title,
.site-title a {
  text-shadow: 0 1px 1px rgba(0,0,0,.25), 0 0 1px rgba(0,0,0,.22);
  /* Ensure no stroke in light theme */
  -webkit-text-stroke: 0;
}

[data-theme='dark'] .greedy-nav a,
[data-theme='dark'] .site-title,
[data-theme='dark'] .site-title a {
  text-shadow: 0 1px 1px rgba(0,0,0,.4), 0 0 1px rgba(0,0,0,.35);
}

/* Thin stroke around masthead and dropdown links (dark theme) */
[data-theme='dark'] .masthead .greedy-nav a,
[data-theme='dark'] .masthead .greedy-nav .hidden-links a,
[data-theme='dark'] .masthead .site-title,
[data-theme='dark'] .masthead .site-title a {
  -webkit-text-stroke: 0.3px rgba(0,0,0,.55);
}

/* CSS: Reveal Animations */
/* Base reveal + state */
.reveal {
  opacity: 0;
  transform: translateY(var(--reveal-offset));
  filter: blur(var(--reveal-blur));
  transition: opacity var(--reveal-duration) var(--reveal-ease),
              transform var(--reveal-duration) var(--reveal-ease),
              filter var(--reveal-duration) var(--reveal-ease);
  will-change: opacity, transform, filter;
}

.reveal.is-revealed { opacity: 1; transform: none; filter: none; }

/* Modifiers */
.reveal--fade  { transform: none; }
.reveal--up    { transform: translateY(calc(var(--reveal-offset) * 1.33)); }
.reveal--scale { transform: scale(0.985); }

/* Stagger children without extra JS */
[data-reveal-stagger] > .reveal { transition-delay: calc(var(--i, 0) * 80ms); }
[data-reveal-stagger] > .reveal:nth-child(n) { --i: n; }

@media (prefers-reduced-motion: reduce) {
  .reveal { opacity: 1 !important; transform: none !important; filter: none !important; }
}

/* CSS: Button Ripple (optional) */
/* Ensure parent can contain the ripple */
.btn, .button, .zen-button { position: relative; overflow: hidden; }

.ripple {
  position: absolute; border-radius: 50%; pointer-events: none; mix-blend-mode: screen;
  background: radial-gradient(circle, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.12) 40%, transparent 60%);
  transform: scale(0); animation: ripple 0.45s ease-out forwards;
}

@keyframes ripple { to { transform: scale(1); opacity: 0; } }

/* ----------------------------------------------------
   Theme Toggle (Footer)
   ---------------------------------------------------- */
/* Use higher specificity to override theme footer li display */
.page__footer-follow .theme-switch {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  margin-inline-end: 10px;
  vertical-align: middle;
  line-height: 1;
}

.page__footer-follow .theme-label {
  font-weight: 700;
  line-height: 1;
  color: var(--c-text);
  opacity: .55;
  display: inline-flex;
  align-items: center;
}

[data-theme='light'] .theme-label--light { opacity: 1; }
[data-theme='dark']  .theme-label--dark  { opacity: 1; }

.page__footer-follow .theme-toggle {
  -webkit-appearance: none;
  appearance: none;
  border: 0;
  background: transparent;
  padding: 0;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
}

.theme-toggle__track {
  position: relative;
  width: 58px;
  height: 28px;
  border-radius: 999px;
  background: linear-gradient(180deg, #5887ff, #3c6be0);
  box-shadow: 0 10px 18px rgba(0,0,0,.25);
  display: inline-block;
}

.theme-toggle__thumb {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 6px 12px rgba(0,0,0,.25);
  transition: transform var(--t-med) var(--e-out);
}

[data-theme='dark'] .theme-toggle__thumb { transform: translateX(30px); }

.theme-toggle__icon {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 16px 16px;
  line-height: 1;
  transition: opacity var(--t-fast) var(--e-out);
}
.theme-toggle__icon--left { left: 10px; }
.theme-toggle__icon--right { right: 10px; }

/* Inline SVG icons via data URIs */
/* Moon icon (for dark mode / checked) */
.theme-toggle__icon--left {
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none'><path d='M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z' fill='%23ffffff'/></svg>");
}

/* Sun icon (for light mode / unchecked) */
.theme-toggle__icon--right {
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='12' r='4' fill='%23ffffff'/><line x1='12' y1='1' x2='12' y2='3'/><line x1='12' y1='21' x2='12' y2='23'/><line x1='4.22' y1='4.22' x2='5.64' y2='5.64'/><line x1='18.36' y1='18.36' x2='19.78' y2='19.78'/><line x1='1' y1='12' x2='3' y2='12'/><line x1='21' y1='12' x2='23' y2='12'/><line x1='4.22' y1='19.78' x2='5.64' y2='18.36'/><line x1='18.36' y1='5.64' x2='19.78' y2='4.22'/></svg>");
}

[data-theme='light'] .theme-toggle__icon--left { opacity: .35; }
[data-theme='light'] .theme-toggle__icon--right { opacity: 1; }
[data-theme='dark']  .theme-toggle__icon--left { opacity: 1; }
[data-theme='dark']  .theme-toggle__icon--right { opacity: .35; }

.theme-toggle:focus-visible .theme-toggle__track {
  outline: 2px solid var(--c-accent);
  outline-offset: 3px;
}

/* Little star near the moon when in dark mode */
.theme-toggle__icon--left::after {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  left: 12px;   /* to the right of moon */
  top: -4px;    /* slightly above */
  background-repeat: no-repeat;
  background-size: 8px 8px;
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--t-fast) var(--e-out);
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 6 6' fill='%23ffffff'><polygon points='3,0 3.8,2.2 6,3 3.8,3.8 3,6 2.2,3.8 0,3 2.2,2.2'/></svg>");
}

[data-theme='dark'] .theme-toggle__icon--left::after { opacity: 1; }

/* Footer navigation with pipes */
.page__footer-nav { margin: 0 0 8px; text-align: center; }
.page__footer-nav a {
  color: inherit;
  font-weight: 700;
  text-decoration: none;
  font-size: calc(1em - 1px); /* inherit default size */
}
.page__footer-nav a:hover { text-decoration: underline; }
.page__footer-nav .pipe { opacity: .45; margin: 0 .4em; }

/* Shrink nav links and toggle on small screens */
@media (max-width: 480px) {
  .page__footer-nav a { font-size: calc(1em - 2.5px); }
  .page__footer-follow .theme-switch {
    transform: scale(0.85);
    transform-origin: center;
  }
}
