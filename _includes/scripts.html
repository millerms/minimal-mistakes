<script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

{% if site.search == true or page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}

<script>
  (function () {
    var STORAGE_KEY = 'theme';
    var root = document.documentElement;

    function applyTheme(theme) {
      try { root.setAttribute('data-theme', theme); } catch (e) {}
      var btn = document.querySelector('.theme-toggle');
      if (btn) btn.setAttribute('aria-pressed', String(theme === 'dark'));
    }

    function getPreferred() {
      try {
        var stored = localStorage.getItem(STORAGE_KEY);
        if (stored === 'dark' || stored === 'light') return stored;
      } catch (e) {}
      return root.getAttribute('data-theme') || 'light';
    }

    function toggleTheme() {
      var next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      try { localStorage.setItem(STORAGE_KEY, next); } catch (e) {}
      applyTheme(next);
    }

    document.addEventListener('DOMContentLoaded', function () {
      applyTheme(getPreferred());
      var el = document.querySelector('.theme-toggle');
      if (el) {
        el.addEventListener('click', function (e) { e.preventDefault(); toggleTheme(); });
        el.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleTheme(); }
        });
      }
    });
  })();
</script>
